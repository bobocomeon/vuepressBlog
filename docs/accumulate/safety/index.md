# 安全
## 内容安全策略(csp)
- csp的主要目的是减少xss攻击，xss攻击利用浏览器对服务器获取内容的信任，恶意脚本得以在浏览器中运行，由于浏览器信任其内容来源，即使有的时候这些并非来自它该来的地方。
- 比如禁止不安全的内联动态执行,和只能通过https加载这些资源 (images, fonts, scripts, etc.)
<meta http-equiv="Content-Security-Policy" content="default-src https:">

## 浏览器同源策略
> `如果两个url的协议端口和域名都相同，就称这个两个url同源`
- dom层面，限制来自不同源的js脚本对当前dom对象的读写操作
- 数据层面， 限制不同源站点读取当前的cookie、indexdb、localstorage
- 网络层面，通过XMLHttpRequest会跨域
但是可以内联指向js，以及请求js资源图片不会跨域，这就出现了csp，可以让服务器决定浏览器可以加载哪些资源，以及是否能执行内联的js代码。

## XSS攻击（跨站脚本攻击）
- 带来的危害： 获取cookie信息，操作修改dom，发送恶意请求，在页面生成弹窗广告
### 存储型xss
利用站点漏洞将一段恶意的js代码提交到网站的数据库中，然后用户想网站请求时，包含的这段恶意js代码，用户浏览页面时，恶意脚本就会将用户cookie等数据上传到服务器。
### 反射型xss
- 恶意js脚本属于用户发送给网站请求的一部分，然后网站又把恶意的js脚本返回给了用户，然后这段js脚本在用户页面中执行
- 很常见的时候我们在搜索的时候，搜索的内容通过key-value的方式发送给服务器，服务器读取到key值，直接把value值返回过来，里面就包含了恶意代码
- 在现实生活当中，黑客经常会通过qq群或邮件等渠道去诱导用户去点击恶意链接
- web服务器不会存储反射型xss的恶意脚本
### dom型xss
- 这个不牵扯到web服务器，常见就是黑客通过各种手段将恶意脚本注入到用户的页面中，比如通过网络劫持在传输过程总修改html页面的内容，比如wifi路由器，本地恶意软件。
### 如何阻止
- 服务器对输入脚本进行过滤，比如将关键字转码 `<=&lt; >=&gt`
- 充分利用csp，可以禁止内联js代码执行，以及外域的资源文件，禁止向第三方域提交哦数据
- 使用httponly属性，防止cookie读写
- 在开发中尽量少使用innerhtml或vue中v-html
## csrf（跨站请求伪造）
- csrf攻击是黑客利用了用户的登录状态，并通过第三方站点来做一些坏事
### 常见攻击流程
我们在登录A站点之后，以及保留了登录状态，攻击者引诱用户打开b网站，然后悄悄的在b网站向a网站发送网络请求，由于a网站有登录状态，此时发送到b站点是以受害者的身份，然后进行了一些操作。

- 自动发起get请求，在页面的img标签的src中嵌入链接
- 自动发起post请求，构造伪造表单
- 引诱用户点击链接，常见在论坛和恶意邮件
- 和xss不同的是，csrf攻击不需要将恶意代码注入用户页面，仅仅是利用服务器漏洞和用户登录状态来实施攻击，利用用户对浏览器的信任
### 防御csrf攻击
- 充分利用好cookie的samesie属性，strict禁止所有第三方，lax可以试get的提交=表单，none是没有；
  - 设置了strict，比如在a网站通过`<a href="https://www.infoq.cn/sendcoin?user=hacker&number=100">`是不会带上infoq的cookie，img图片请求只会带上none属性的信息
- 验证请求来源站点 Rerefer以及origin这个是可以被修改
- csrf token 在浏览器向服务器发起请求时，服务器生成一个csrftoken，然后将该字符串植入到返回的页面中