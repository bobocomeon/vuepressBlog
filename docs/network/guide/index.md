# 网络

总结高频问题

## 从浏览器地址栏输入url到请求返回发生了什么
可以延展出很多情况，考虑进去
### 进行url解析，根据dns系统进行ip查找
- url为啥要解析
  - 网络标准规定了URL只能是字母和数字，还有一些其他特殊符号`(@ & = + $ , / ? # [ ])`,比较常见的是不包括百分号和双引号
- encodeURIComponent和encodeURI有什么区别
  - `encodeURIComponent`编码范围更广，时候给参数编码，`encodeURI`适合给url本省`location.origin`编码,一版项目里面都是用qs库处理
- dns查询的规则是什么
  - 比如查询网址浏览器中输入`baidu.com`,会先查询hosts文件是否有记录，有的话把对应`ip`地址进行返回
  - hosts文件没有就去查本地`dns解析器`是否有缓存
  - 再去我们计算机上配置的`dns服务器`上是否有没有缓存
  - 没找到缓存就去找DNS服务器,然后可以找到`.com域名`是哪个服务器管理，查找到对应的ip，再去`.baidu.com`服务器是否能解析，直到查到`www.baidu.com`的ip地址

前端的dns优化，可以再html页面头部写入dns缓存地址
```
<meta http-equiv="x-dns-prefetch-control" content="on" />
<link rel="dns-prefetch" href="http://bdimg.share.baidu.com" />
```
### 查到ip之后就是http协议的三次握手和四次挥手
tcp是`可靠，面向连接，字节流`单播协议，在发送数据前，通信双方必须在彼此间建立一条连接，所谓连接即客户端和服务器的内存里保存的一份关于对方的信息，如`ip地址、端口号`等。

tcp可看成一种字节流，它会处理IP层或以下的丢包、重复以及错误问题，在连接的建立过程中，双方需要交换一些参数，在写参数在`TCP头部`。
```
ACK 确认，使得确认号有效
RST 重置连接
SYN 初始化连接序列号
FIN 改报文段的发送发以及结束向对方发送数据
ACK报文是用来应答，SYN报文是用来同步
```
#### 三次握手
1. 客户端发送一个`SYN段`，并指明客户端的初始序列号`seq=x`。
2. 服务端发送自己的`SYN`作为应答，同样指明自己的`seq`，为了确认客户端的`SYN`，将自己的`seq+1`作为`ACK`数值,这样没发送一个SYN，序列号就会加1，如果有丢失的情况，就会重传。
3. 为了确认服务器端的`SYN`，客户端将`seq+1`作为返回的ACK数值。

#### 四次挥手
1. 客户端发送一个`FIN段`，并包含一个希望接受者看到自己当前`序列号K`，同时还包含一个`ACK`表示确认对方最近一次发过来的数据。
2. 服务端将`k值加1`，作为`ACK序号值`，表明收到了上一个包，这时上层的应用程序会被告知另一端发起了关闭操作，通常这将引起应用程序发起自己的关闭操作。
3. 服务端发起自己的FIN段，`ACK=K+1、seq=L4`,客户端确认，`ACK=L+1`。

### cnd的工作原理
1. 用户向`www.a.com`下制定资源发送请求时，首先向本地DNS发起域名解析请求
2. 本地DNS检查是否有`www.a.com`的IP地址记录，有就直接返回，否则向授权DNS查询
3. 当授权DNS解析`www.a.com`时，返回域名`CNAME` => `www.a.com`对应的ip地址
4. 域名解析请求发送到DNS调度系统，并分配最佳节点ip地址
5. 本地DNS获取DNS返回的解析IP地址
6. 用户获取解析IP地址
7. 用户向获取ip地址发起对该资源的请求访问
- 如果该IP地址对应的节点已缓存该资源，则直接将数据返回给用户
- 如果对应的ip地址未缓存该资源，则节点向向源站点发起该资源的请求，结合用户的配置的缓存策略，将资源缓存在该节点。
<!-- ![avatar](../.vuepress/public/images/cdn.png) -->

